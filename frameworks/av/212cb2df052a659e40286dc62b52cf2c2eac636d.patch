From 212cb2df052a659e40286dc62b52cf2c2eac636d Mon Sep 17 00:00:00 2001
From: Robert Shih <robertshih@google.com>
Date: Fri, 1 Dec 2017 16:12:08 -0800
Subject: [PATCH] httplive: check for malformed EXT-X-STREAM-INF

Bug: 68342866
Test: adb shell am start -a android.intent.action.VIEW -d http://localhost:1137/index.html
Change-Id: I479f9e0b7ca828d048ef88b23b4948e3c1472b3c
(cherry picked from commit e3bd8dd81e51b4d02484e7eec0d725ba9c254c68)
---
 media/libstagefright/httplive/M3UParser.cpp | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/media/libstagefright/httplive/M3UParser.cpp b/media/libstagefright/httplive/M3UParser.cpp
index 0366e701b..403a5da4c 100644
--- a/media/libstagefright/httplive/M3UParser.cpp
+++ b/media/libstagefright/httplive/M3UParser.cpp
@@ -748,6 +748,9 @@ status_t M3UParser::parseStreamInf(
         }
     }
 
+    if (meta->get() == NULL) {
+        return ERROR_MALFORMED;
+    }
     return OK;
 }
 
