From 1ff5343b984a1257d3842e5c6f4bc1e653f971bc Mon Sep 17 00:00:00 2001
From: Julian Winkler <julian.winkler1@web.de>
Date: Thu, 10 Jan 2019 22:31:24 +0100
Subject: [PATCH] work around problems with null pointer exceptions causing
 segfaults

Change-Id: I7186911fdcdb377799d4c628e8566300ebf4bd44
---
 .../com/android/internal/telephony/SubscriptionMonitor.java   | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/src/java/com/android/internal/telephony/SubscriptionMonitor.java b/src/java/com/android/internal/telephony/SubscriptionMonitor.java
index 8ccec6ff0..d2d1dcf4d 100644
--- a/src/java/com/android/internal/telephony/SubscriptionMonitor.java
+++ b/src/java/com/android/internal/telephony/SubscriptionMonitor.java
@@ -108,12 +108,14 @@ public class SubscriptionMonitor {
             new IOnSubscriptionsChangedListener.Stub() {
         @Override
         public void onSubscriptionsChanged() {
+            if(mLock != null)
             synchronized (mLock) {
                 int newDefaultDataPhoneId = INVALID_PHONE_INDEX;
+                if(mPhoneSubId != null && mSubscriptionController != null)
                 for (int phoneId = 0; phoneId < mPhoneSubId.length; phoneId++) {
                     final int newSubId = mSubscriptionController.getSubIdUsingPhoneId(phoneId);
                     final int oldSubId = mPhoneSubId[phoneId];
-                    if (oldSubId != newSubId) {
+                    if (oldSubId != newSubId && mSubscriptionsChangedRegistrants != null) {
                         log("Phone[" + phoneId + "] subId changed " + oldSubId + "->" +
                                 newSubId + ", " +
                                 mSubscriptionsChangedRegistrants[phoneId].size() + " registrants");
-- 
2.20.1

