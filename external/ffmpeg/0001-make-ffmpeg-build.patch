From 79cbe2faeb0a857c2c4f42eb94b9e7860b82aea2 Mon Sep 17 00:00:00 2001
From: Patrick Harbers <jgrharbers@gmail.com>
Date: Thu, 14 Apr 2016 16:11:49 +0200
Subject: [PATCH] [PATCH] Make FFMPEG 3 build

Change-Id: I4d5cece4176bfc19eb7d70ff3f628e0c71f37750
---
 android/build.mk                                     |  2 +-
 android/{config-atom.mak => config-x86-atom.mak}     |  0
 android/include/{config-atom.h => config-x86-atom.h} |  0
 libavcodec/Android.mk                                | 19 -------------------
 libavformat/Android.mk                               | 18 ------------------
 libavutil/Android.mk                                 |  9 ---------
 libswresample/Android.mk                             |  8 --------
 libswscale/Android.mk                                | 10 ----------
 8 files changed, 1 insertion(+), 65 deletions(-)
 rename android/{config-atom.mak => config-x86-atom.mak} (100%)
 rename android/include/{config-atom.h => config-x86-atom.h} (100%)

diff --git a/android/build.mk b/android/build.mk
index 26167ca897..a5e3cd1f75 100644
--- a/android/build.mk
+++ b/android/build.mk
@@ -86,7 +86,7 @@ LOCAL_SRC_FILES := $(C_FILES) $(if $(filter S,$(ASM_SUFFIX)),$(S_FILES))
 intermediates := $(local-intermediates-dir)
 ifeq ($(FFMPEG_ARCH),x86)
 GEN := $(S_OBJS:%=$(intermediates)/%)
-$(GEN): YASM := prebuilts/misc/$(BUILD_OS)-$(HOST_PREBUILT_ARCH)/yasm/yasm
+$(GEN): YASM := yasm
 $(GEN): YASMFLAGS := -felf -DPIC $(LOCAL_C_INCLUDES:%=-I%)
 $(GEN): PRIVATE_CUSTOM_TOOL = $(YASM) $(YASMFLAGS) -Pconfig.asm -o $@ $<
 $(GEN): $(intermediates)/%.o: $(LOCAL_PATH)/%.asm $(SUBDIR)config.asm
diff --git a/android/config-atom.mak b/android/config-x86-atom.mak
similarity index 100%
rename from android/config-atom.mak
rename to android/config-x86-atom.mak
diff --git a/android/include/config-atom.h b/android/include/config-x86-atom.h
similarity index 100%
rename from android/include/config-atom.h
rename to android/include/config-x86-atom.h
diff --git a/libavcodec/Android.mk b/libavcodec/Android.mk
index dce962ef29..ff48230450 100644
--- a/libavcodec/Android.mk
+++ b/libavcodec/Android.mk
@@ -28,22 +28,3 @@ endif
 
 LOCAL_MULTILIB := $(FFMPEG_MULTILIB)
 include $(BUILD_SHARED_LIBRARY)
-
-include $(CLEAR_VARS)
-FFMPEG_MULTILIB := 64
-include $(LOCAL_PATH)/../android/build.mk
-
-LOCAL_C_INCLUDES +=		\
-	external/zlib
-
-LOCAL_SHARED_LIBRARIES +=	\
-	libz \
-	libavutil \
-	libswresample
-
-ifneq ($(ARCH_ARM_HAVE_NEON),)
-  LOCAL_SRC_FILES += neon/mpegvideo.c
-endif
-
-LOCAL_MULTILIB := $(FFMPEG_MULTILIB)
-include $(BUILD_SHARED_LIBRARY)
diff --git a/libavformat/Android.mk b/libavformat/Android.mk
index c74bb5d170..be44e43702 100644
--- a/libavformat/Android.mk
+++ b/libavformat/Android.mk
@@ -27,21 +27,3 @@ LOCAL_SHARED_LIBRARIES +=		\
 
 LOCAL_MULTILIB := $(FFMPEG_MULTILIB)
 include $(BUILD_SHARED_LIBRARY)
-
-include $(CLEAR_VARS)
-FFMPEG_MULTILIB := 64
-include $(LOCAL_PATH)/../android/build.mk
-
-LOCAL_C_INCLUDES +=			\
-	external/openssl/include	\
-	external/zlib
-
-LOCAL_SHARED_LIBRARIES +=		\
-	libcrypto			\
-	libssl				\
-	libz                \
-	libavutil           \
-	libavcodec
-
-LOCAL_MULTILIB := $(FFMPEG_MULTILIB)
-include $(BUILD_SHARED_LIBRARY)
diff --git a/libavutil/Android.mk b/libavutil/Android.mk
index 1408b3e1f7..7e954e3d1e 100644
--- a/libavutil/Android.mk
+++ b/libavutil/Android.mk
@@ -17,12 +17,3 @@ include $(LOCAL_PATH)/../android/build.mk
 LOCAL_MULTILIB := $(FFMPEG_MULTILIB)
 
 include $(BUILD_SHARED_LIBRARY)
-
-
-include $(CLEAR_VARS)
-FFMPEG_MULTILIB := 64
-include $(LOCAL_PATH)/../android/build.mk
-
-LOCAL_MULTILIB := $(FFMPEG_MULTILIB)
-
-include $(BUILD_SHARED_LIBRARY)
diff --git a/libswresample/Android.mk b/libswresample/Android.mk
index 2cf73dd349..848e6cf988 100644
--- a/libswresample/Android.mk
+++ b/libswresample/Android.mk
@@ -16,11 +16,3 @@ include $(LOCAL_PATH)/../android/build.mk
 
 LOCAL_MULTILIB := $(FFMPEG_MULTILIB)
 include $(BUILD_SHARED_LIBRARY)
-
-
-include $(CLEAR_VARS)
-FFMPEG_MULTILIB := 64
-include $(LOCAL_PATH)/../android/build.mk
-
-LOCAL_MULTILIB := $(FFMPEG_MULTILIB)
-include $(BUILD_SHARED_LIBRARY)
diff --git a/libswscale/Android.mk b/libswscale/Android.mk
index 9e5db67aa9..fcad683933 100644
--- a/libswscale/Android.mk
+++ b/libswscale/Android.mk
@@ -19,13 +19,3 @@ LOCAL_SHARED_LIBRARIES += \
 
 LOCAL_MULTILIB := $(FFMPEG_MULTILIB)
 include $(BUILD_SHARED_LIBRARY)
-
-include $(CLEAR_VARS)
-FFMPEG_MULTILIB := 64
-include $(LOCAL_PATH)/../android/build.mk
-
-LOCAL_SHARED_LIBRARIES += \
-	libavutil
-
-LOCAL_MULTILIB := $(FFMPEG_MULTILIB)
-include $(BUILD_SHARED_LIBRARY)
