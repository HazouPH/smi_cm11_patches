From b54be5a54a03b7d49f103f5709cffbd0a12a9ceb Mon Sep 17 00:00:00 2001
From: Patrick Harbers <jgrharbers@gmail.com>
Date: Sun, 26 Feb 2017 23:54:40 +0100
Subject: [PATCH] Fix build

Change-Id: I76c518743928825a9094e4547443e2586dea709e
---
 libvpx.mk        | 7 ++++++-
 x86/vpx_config.h | 1 -
 2 files changed, 6 insertions(+), 2 deletions(-)

diff --git a/libvpx.mk b/libvpx.mk
index 2075b94..559cb9f 100644
--- a/libvpx.mk
+++ b/libvpx.mk
@@ -42,6 +42,11 @@ libvpx_codec_srcs := $(shell cat $(libvpx_config_dir)/libvpx_srcs.txt)
 
 LOCAL_CFLAGS := -DHAVE_CONFIG_H=vpx_config.h
 
+ifeq ($(TARGET_ARCH),x86)
+LOCAL_ASFLAGS += -D__ANDROID__
+LOCAL_CFLAGS += $(LOCAL_ASFLAGS)
+endif
+
 LOCAL_MODULE := libvpx
 
 LOCAL_MODULE_CLASS := STATIC_LIBRARIES
@@ -77,7 +82,7 @@ ifeq ($(libvpx_target),x86)
 $(X86_ASM_OBJS) : $(X86_ASM_SRCS)
 $(libvpx_intermediates)/%.asm.o: $(LOCAL_PATH)/libvpx/%.asm
 	mkdir -p `dirname $@`
-	yasm -f elf32 -I$(LOCAL_VPX)/ -I$(LOCAL_VPX)/x86/ -I$(LOCAL_VPX)/libvpx/ -o $@ $<
+	yasm -f elf32 -D__ANDROID__ -I$(LOCAL_VPX)/ -I$(LOCAL_VPX)/x86/ -I$(LOCAL_VPX)/libvpx/ -o $@ $<
 
 LOCAL_GENERATED_SOURCES += $(X86_ASM_OBJS)
 LOCAL_PREBUILT_MODULE_FILE += $(X86_ASM_OBJS)
diff --git a/x86/vpx_config.h b/x86/vpx_config.h
index 528c5ba..a786b06 100644
--- a/x86/vpx_config.h
+++ b/x86/vpx_config.h
@@ -7,7 +7,6 @@
 /* be found in the AUTHORS file in the root of the source tree. */
 /* This file automatically generated by configure. Do not edit! */
 #ifndef VPX_CONFIG_H
-#define __ANDROID__
 #define VPX_CONFIG_H
 #define RESTRICT
 #define INLINE      inline
-- 
2.7.4

